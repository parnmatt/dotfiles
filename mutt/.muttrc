# Personal Details
set realname = "Matthew Parnell"
set from     = "m.parnell@lancaster.ac.uk"
set envelope_from

# Receiving mail
set folder = ~/.mail
set mbox_type = Maildir
set timeout = 3
set mail_check = 0
set beep_new
set nowait_key

set spoolfile = "=INBOX"
set record = "=Sent Items"
set postponed = "=Drafts"
mailboxes = "=INBOX"

set header_cache = ~/.cache/mutt/headers
set message_cachedir = ~/.cache/mutt/bodies
set mailcap_path = ~/.config/mutt/mailcap

# Index
set sort = threads
set strict_threads

bind index R group-reply
bind index <tab> sync-mailbox
bind index - collapse-thread
bind index _ collapse-all

macro index <F5> \
    "<enter-command>set my_old_wait_key=\$wait_key nowait_key<enter>\
    <shell-escape>pkill -USR1 offlineimap<enter>\
    <enter-command>set wait_key=\$my_old_wait_key<enter>"

macro index <F8> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode nopipe_decode\
    my_old_wait_key=\$wait_key nowait_key<enter>\
    <shell-escape>notmuch-mutt -r --prompt search<enter>\
    <change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode\
    wait_key=\$my_old_wait_key<enter>" \
        "notmuch: search mail"

macro index <F9> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode nopipe_decode\
    my_old_wait_key=\$wait_key nowait_key<enter>\
    <pipe-message>notmuch-mutt -r thread<enter>\
    <change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode\
    wait_key=\$my_old_wait_key<enter>" \
        "notmuch: reconstruct thread"

macro index <F6> \
    "<enter-command>set my_old_pipe_decode=\$pipe_decode nopipe_decode\
    my_old_wait_key=\$wait_key nowait_key<enter>\
    <pipe-message>notmuch-mutt tag -- -inbox<enter>\
    <enter-command>set pipe_decode=\$my_old_pipe_decode\
    wait_key=\$my_old_wait_key<enter>" \
        "notmuch: remove message from inbox"


# Sending mail
set sendmail = "msmtp -a lancs"
set sendmail_wait = -1

set fast_reply
set forward_format = "Fwd: %s"
set text_flowed
set sig_dashes
set nosig_on_top
set signature = ~/.config/mutt/sig

# Aliases
alias me Matthew Parnell <m.parnell@lancaster.ac.uk>
source "gpg2 -dq ~/.config/mutt/aliases.gpg |"

# Mailing Lists
source "gpg2 -dq ~/.config/mutt/lists.gpg |"
set followup_to
set honor_followup_to

# Message options
set editor = "vim -f"
set display_filter = ~/.config/mutt/local_time.py

# Pager
alternative_order text/plain text/html
auto_view text/html

# Vim keybindings
# Generic
bind generic h select-entry
# Index
bind index h change-folder
bind index l display-message
bind index gg first-entry
bind index G last-entry
# Pager
bind pager h exit
bind pager j next-line
bind pager k previous-line
bind pager l view-attachments
bind pager i display-toggle-weed
# Attach
bind attach h exit
bind attach l view-attach
# Compose
bind compose l view-attach
